<!DOCTYPE html>
    <html lang="en">
        <head>
            <title>On Going Trip</title>
            <meta charset="utf-8"/>
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <link rel ="stylesheet" type="text/css" href="css/commontheme.css">
             <link rel ="stylesheet" type="text/css" href="css/stylesheet.css">
        </head>
        <body>
            <div class="container-fluid">
             <div class="row">
                     <!--nav starts-->
                     <nav class="navbar navbar-expand-lg navbar-light bg-light bg-topnav topnav-border p-0">
                      <a class="navbar-brand" href="cab-application-masterpage.html"><img src="images/cab-application-logo.png" class="cabapp-logo" alt="cablogo"></a>
                      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                      </button>
                      <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="list-group list-group-horizontal">
                          <li class="list-group-item nav-menu bookacab-tabactive"><a class="link bookacab-tab " href="#" onclick="getTripSheet()">Book A Cab/Ongoing Trip</a></li>
                          <li class="list-group-item nav-menu"><a class="link myrequest-tab " href="cab-app-my request.html">My Request</a></li>
                       </ul>
                      </div>
                      <div class="float-end d-none d-sm-block ipad-responsive">
                        <!--contact starts-->
       <div class="float-start">
        <div class="header-right">
          <div class="dropdown col-md-12 float-start">
              <img  src="images/phone-call.png" class="navphone-icons cursor" alt="filter-icon" title="Admin Contacts" id="adminContactsBtn" data-toggle="dropdown" aria-expanded="true">
          <div class="dropdown-menu m-0 p-3 Admin-contact-popover" >
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-12 pb-2 border-0 mb-3"><span class="text-style-title filter-title">Admin Contacts</span>
                      <button type="button" class="btn-close float-end close-filter" data-dismiss="advanced-filter" aria-label="Close">
                    </button>
                    </div>
                  
                     <div class="col-md-12 ">
                      <div class="row mb-3">
                          <div id="adminContacts">
                           </div>
                          </div>
                      </div>
                    </div>
                </div>
            </div>
          </div>
        </div>
       </div>
        <!--contact ends-->
        <!--notification starts-->
                    <div class="float-start">
                      <div class="header-right">
                        <div class="dropdown col-md-12 float-start">
                          
                            <img src="images/notification.png" class="navnotify-icons cursor" alt="filter-icon" title="Notification"  data-toggle="dropdown" aria-expanded="true"/>
                          
                        <div class="dropdown-menu m-0 py-3 notification-popover" >
                          <div class="container-fluid">
                              <div class="row">
                                  <div class="col-md-12 pb-2 topnav-border w-100 mb-3 "><span class="text-style-title filter-titlenotification">Notification</span>
                                    <button type="button" class="btn-close float-end close-filter" data-dismiss="advanced-filter" aria-label="Close">
                                  </button>
                                  </div>
                                  
                                   <div class="col-md-12">
                                    <div class="row mb-3">
                                        <div class="topnav-border">
                                            <div class=" col-md-12 float-start w-100">
                                                <img src="images/notification-icon.png" class="notification-icon float-start" alt="notifyicon">
                                                <p class="float-start notification-content">Your trip sheet has been generated</p>
                                              </div>
                                            <div class="float-end">
                                                <h6 class="notification-time float-end ">10:15PM</h6>
                                              </div>
                                        </div>
                                        
                                        <div class="topnav-border">
                                            <div class=" col-md-12 float-start w-100">
                                                <img src="images/notification-icon.png" class="notification-icon float-start" alt="notifyicon">
                                                <p class="float-start notification-content">Your trip sheet has been generated</p>
                                              </div>
                                                <div class="float-end" >
                                                  <h6 class="notification-time float-end ">10:15PM</h6>
                                                </div>
                                        </div>
                                        
                                         <div class="topnav-border">
                                            <div class=" col-md-12 float-start w-100">
                                                <img src="images/notification-icon.png" class="notification-icon float-start" alt="notifyicon">
                                                <p class="float-start notification-content">Your trip sheet has been generated</p>
                                              </div>
                                                <div class="float-end" >
                                                  <h6 class="notification-time float-end ">10:15PM</h6>
                                                </div>
                                         </div>
                                         
                                         <div>
                                            <div class=" col-md-12 mt-3 ">
                                                <div class="col-md-6 float-start">
                                                  <h6 class="total-records">2 Notification</h6>
                                                </div>
                                                <div class="col-md-6 float-end">
                                                   <h6 class="float-end total-records">Mark as read</h6>
                                                </div>
                                               </div>
                                         </div>
                                      </div>
                                    </div>
                                  </div>
                              </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <!--notification here-->
                   <!--user profile starts-->
        <div class="float-start">
          <div class="header-right">
            <div class="dropdown col-md-12 float-start">
              
                <img src="images/user-profile.png" class="navuserprofile-icons cursor"  alt="filter-icon" title="user-profile"  data-toggle="dropdown" aria-expanded="true"/>
              
            <div class="dropdown-menu m-0 p-3 profile-popover" >
              <div class="container-fluid">
                  <div class="row">
                      <div class="col-md- pb-2 border-0 mb-3">
                        <button type="button" class="btn-close float-end close-filter" data-dismiss="advanced-filter" aria-label="Close">
                      </button>
                      </div>
                    
                       <div class="col-md-12">
                        <div class="row mb-3">
                            <div>
                                
                                  <div class="row justify-content-center">
                                    <img src="images/user-profile-icon.png" class="user-profile-icon text-center" alt="profileicon">
                                    <h6 class="username text-center mt-2">Nithya</h6>
                                    <div>
                                      <div class=" col-md-12 col-12 float-start userprofile-content pt-2">UX Designer</div>
                                      <div class=" col-md-12 col-12 float-start userprofile-content  pt-2">Emp ID: 4569</div>
                                      <div class=" col-md-12 col-12 float-start userprofile-content  pt-2">Domain Lead: Rafi</div>
                                      <div class=" col-md-12 col-12 float-start userprofile-content  pt-2">Project: Cab Application</div>
                                      <div class=" col-md-12 col-12 float-start userprofile-content  pt-2">Project lead: Rafi</div>
                                    </div>
                                  </div>
                                
                                </div>
                                <div class="row justify-content-center mb-3 mt-2">
                                  <div class="col-md-12 text-center">
                                    <button type="button" class="btnlogoutbtn mt-2 " id="logout">Logout</button>
                                   </div>
                             </div>
                            </div>
                        </div>
                      </div>
                  </div>
              </div>
            </div>
          </div>
        </div>
        <!--user profile ends-->
                    </div>
                    </nav>
                    <div class="float-end  d-block d-sm-none responsive-mb ipad-block">
                      <!--contact starts-->
                     <div class="float-end">
                      <div class="float-start">
                        <div class="header-right">
    
                          <div class="dropdown col-md-12 float-start">
                             <a href="#"  data-toggle="dropdown" aria-expanded="true"> <img  src="images/phone-call.png" class="navphone-icons cursor" alt="filter-icon" title="Admin Contacts" ></a>
                          <div class="dropdown-menu m-0 p-3 Admin-contact-popover" >
                            <div class="container-fluid">
                                <div class="row">
                                    <div class="col-md-12 pb-2 border-0 mb-3"><span class="text-style-title filter-title">Admin Contacts</span>
                                      <button type="button" class="btn-close float-end close-filter" data-dismiss="advanced-filter" aria-label="Close">
                                    </button>
                                    </div>
                                  
                                     <div class="col-md-12 ">
                                      <div class="row mb-3">
                                          <div>
                                      <label class="float-start"><a class="link contact-number" href="#">+91 (123)456-7890</a>-Raghavan</label>
                                      <label class="float-start"><a class="link contact-number" href="#">+91 (456)778-4569</a>-Santhosh</label>     
                                           </div>
                                          </div>
                                      </div>
                                    </div>
                                </div>
                            </div>
                          </div>
                        </div>
                       </div>
                        <!--contact ends-->
                        <!--notification starts-->
                                    <div class="float-start">
                                      <div class="header-right">
                                        <div class="dropdown col-md-12 float-start">
                                          
                                            <img src="images/notification.png" class="navnotify-icons cursor" alt="filter-icon" title="Notification"  data-toggle="dropdown" aria-expanded="true"/>
                                          
                                        <div class="dropdown-menu m-0 py-3 notification-popover" >
                                          <div class="container-fluid">
                                              <div class="row">
                                                  <div class="col-md-12 pb-2 topnav-border w-100 mb-3 "><span class="text-style-title filter-titlenotification">Notification</span>
                                                    <button type="button" class="btn-close float-end close-filter" data-dismiss="advanced-filter" aria-label="Close">
                                                  </button>
                                                  </div>
                                                  
                                                   <div class="col-md-12">
                                                    <div class="row mb-3">
                                                        <div class="topnav-border">
                                                            <div class=" col-md-12 float-start w-100">
                                                                <img src="images/notification-icon.png" class="notification-icon float-start" alt="notifyicon">
                                                                <p class="float-start notification-content">Your trip sheet has been generated</p>
                                                              </div>
                                                            <div class="float-end">
                                                                <h6 class="notification-time float-end ">10:15PM</h6>
                                                              </div>
                                                        </div>
                                                        
                                                        <div class="topnav-border">
                                                            <div class=" col-md-12 float-start w-100">
                                                                <img src="images/notification-icon.png" class="notification-icon float-start" alt="notifyicon">
                                                                <p class="float-start notification-content">Your trip sheet has been generated</p>
                                                              </div>
                                                                <div class="float-end" >
                                                                  <h6 class="notification-time float-end ">10:15PM</h6>
                                                                </div>
                                                        </div>
                                                        
                                                         <div class="topnav-border">
                                                            <div class=" col-md-12 float-start w-100">
                                                                <img src="images/notification-icon.png" class="notification-icon float-start" alt="notifyicon">
                                                                <p class="float-start notification-content">Your trip sheet has been generated</p>
                                                              </div>
                                                                <div class="float-end" >
                                                                  <h6 class="notification-time float-end ">10:15PM</h6>
                                                                </div>
                                                         </div>
                                                         
                                                         <div>
                                                            <div class=" col-md-12 mt-3 ">
                                                                <div class="col-md-6 float-start">
                                                                  <h6 class="total-records">2 Notification</h6>
                                                                </div>
                                                                <div class="col-md-6 float-end">
                                                                   <h6 class="float-end total-records">Mark as read</h6>
                                                                </div>
                                                               </div>
                                                         </div>
                                                      </div>
                                                    </div>
                                                  </div>
                                              </div>
                                          </div>
                                        </div>
                                      </div>
                                    </div>
                                    <!--notification here-->
                                   <!--user profile starts-->
                        <div class="float-start">
                          <div class="header-right">
                            <div class="dropdown col-md-12 float-start">
                              
                                <img src="images/user-profile.png" class="navuserprofile-icons cursor"  alt="filter-icon" title="user-profile"  data-toggle="dropdown" aria-expanded="true"/>
                              
                            <div class="dropdown-menu m-0 p-3 profile-popover" >
                              <div class="container-fluid">
                                  <div class="row">
                                      <div class="col-md- pb-2 border-0 mb-3">
                                        <button type="button" class="btn-close float-end close-filter" data-dismiss="advanced-filter" aria-label="Close">
                                      </button>
                                      </div>
                                    
                                       <div class="col-md-12">
                                        <div class="row mb-3">
                                            <div>
                                                
                                                  <div class="row justify-content-center">
                                                    <img src="images/user-profile-icon.png" class="user-profile-icon text-center" alt="profileicon">
                                                    <h6 class="username text-center mt-2">Nithya</h6>
                                                    <div>
                                                      <div class=" col-md-12 col-12 float-start userprofile-content pt-2">UX Designer</div>
                                                      <div class=" col-md-12 col-12 float-start userprofile-content  pt-2">Emp ID: 4569</div>
                                                      <div class=" col-md-12 col-12 float-start userprofile-content  pt-2">Domain Lead: Rafi</div>
                                                      <div class=" col-md-12 col-12 float-start userprofile-content  pt-2">Project: Cab Application</div>
                                                      <div class=" col-md-12 col-12 float-start userprofile-content  pt-2">Project lead: Rafi</div>
                                                    </div>
                                                  </div>
                                                
                                                </div>
                                                <div class="row justify-content-center mb-3 mt-2">
                                                  <div class="col-md-12 text-center">
                                                    <button type="button" class="btnlogoutbtn mt-2 ">Logout</button>
                                                   </div>
                                             </div>
                                            </div>
                                        </div>
                                      </div>
                                  </div>
                              </div>
                            </div>
                          </div>
                        </div>
                        <!--user profile ends-->
                     </div>
                  </div>
                    
                  <!--nav ends-->
                
               <div>
                   <h3 class="ongoing-trip-title">Ongoing Trip</h3>
                   <div class="col-md-12 ">
                      <div class="col-md-2 col-12 width-responsive pt-2 float-start">
                        <div class="detail">
                            Cab Number:                
                        </div>
                        <div class="detail-answer pb-4" id="cabnumber">
                            
                        </div>
                      </div>
                      <div class="col-md-2 col-12 width-responsive pt-2 float-start">
                        <div  class="detail">
                             Driver Name:
                            
                        </div>
                        <div class="detail-answer pb-4" id="drivername">                           
                        </div>
                      </div>
                      <div class="col-md-2 col-12 pt-2 width-responsive float-start">
                        <div  class="detail">
                            Driver Contact Number:
                            
                        </div>
                        <div class="detail-answer pb-4" id="drivernumber">
                        </div>
                      </div>
                      <div class="col-md-2 col-12 pt-2 width-responsive float-start">
                        <div  class="detail">
                            Destination:
                            
                        </div>
                        <div class="detail-answer pb-4" id="destination">
                        </div>
                      </div>
                      <div class="col-md-2 col-12 pt-2 width-responsive float-start">
                        <div  class="detail">
                            Date:
                        </div>
                        <div class="detail-answer pb-4" id="date">
                        </div>
                      </div>
                      <div class="col-md-2 col-12 pt-2 width-responsive float-start">
                        <div  class="detail">
                            Time Slot:
                            
                        </div>
                        <div class="detail-answer pb-4" id="timeslot">
                        </div>
                      </div>
                      
                   </div>
                </div>
                <div class="responsive-customise">
                  <table class="table mt-2 mb-0 caps-grid" >
                    <thead >
                      <tr class="display-shadow" >
                        <th class=" header-class">S.No</th>
                        <th class="col header-class">Employee Name</th>
                        <th class="col header-class">Employee ID</th>
                        <th class="col header-class">Drop Point</th>
                      </tr>
                    </thead>
                    <tbody id="tablebody">
                      <!--tr  class="row-bg-style" >
                        <td class=" number-spacing">1</td>
                        <td class="spacing">Maniyarasi</td>
                        <td class="spacing">2345</td>
                        <td class="spacing">Shollinganallur</td>
                      </tr>
                      <tr class="row-bg-style">
                        <td class=" number-spacing">2</td>
                        <td class="spacing">Saravanan</td>
                        <td class="spacing">4567</td>
                        <td class="spacing">Shollinganallur</td>
                      </tr>
                      <tr class="row-bg-style">
                        <td class=" number-spacing">3</td>
                        <td class="spacing">Anthea</td>
                        <td class="spacing">6738</td>
                        <td class="spacing">Shollinganallur</td>

                      </tr>
                      <tr class="row-bg-style">
                        <td class=" number-spacing">4</td>
                        <td class="spacing">Jeyasree</td>
                        <td class="spacing">0979</td>
                        <td class="spacing">Shollinganallur</td>
                      </tr>
                      <tr class="row-bg-style">
                        <td class=" number-spacing">5</td>
                        <td class="spacing">Soumi</td>
                        <td class="spacing">4536</td>
                        <td class="spacing">Navalur</td>
                      </tr>
                      <tr class="row-bg-style">
                        <td class=" number-spacing">6</td>
                        <td class="spacing" >Soundarya</td>
                        <td class="spacing">3458</td>
                        <td class="spacing">Navalur</td>

                      </tr>
                      <tr class="row-bg-style">
                        <td class=" number-spacing">7</td>
                        <td class="spacing">Ruben</td>
                        <td class="spacing">2829</td>
                        <td class="spacing">Navalur</td>

                      </tr-->
                    </tbody>
                  </table>
                </div>
               <div class="col-md-12 col-12 float-start mt-3">
                  <h6 class="total-records" id= "passengers"></h6>
               </div>
             </div>
            </div>
            <script src="js/jquery.min.js"></script>
            <script src="js/popper.js"></script>
            <script src="js/bootstrap.min.js"></script>
            <script src="js/logout.js"></script>
            
            <script src="js/ajaxHandler.js"></script>
            
            <script>
             $('.advanced-filter').click(function (event) {
             event.stopPropagation();
             
           });
               $('#close-filter').click(function(){
           $('.advanced-filter').removeClass('show');
           })
           </script>
           
           <script type="text/javascript">
           
           
           var employee = JSON.parse(sessionStorage.getItem("employee"));
   		
           var empId = employee.employeeId;
       	var empName = employee.employeeName;
       	
   	       var jwtToken = sessionStorage.getItem("jwtToken")
   	       
           window.onload = getTripSheet;
           var xhr = new XMLHttpRequest();
           function getTripSheet() {
            xhr.open("GET", "http://localhost:8080/api/v1/requests/" + empId, true);
            xhr.setRequestHeader("Authorization", jwtToken);
            xhr.onreadystatechange = processResponse;
            xhr.send(null);

           }

           function processResponse() {

            if(xhr.readyState == 4 && xhr.status == 200) {
				
            	if(xhr.responseText == "" || xhr.responseText == undefined) {
              	  window.location.href = "/cab-application-masterpage.html";
                }
            	
              var tripSheet = JSON.parse(this.responseText);
              displaySheet(tripSheet);
            }

           }

           var counter = 0;
           function displaySheet(obj) {

            var rowLength = obj.length;
            document.getElementById("cabnumber").innerHTML = obj[0].cabDetails.cabNumber;
            document.getElementById("drivername").innerHTML = obj[0].driverDetails.driverName;
            document.getElementById("drivernumber").innerHTML = obj[0].driverDetails.driverNumber;
            document.getElementById("destination").innerHTML = obj[0].destination;     
             var date = obj[0].cabDetails.dateOfTravel;
             var dateOfTravel = date.split("\-");
             document.getElementById("date").innerHTML = dateOfTravel[2] + "-" + dateOfTravel[1] + "-" + dateOfTravel[0];
             var date = obj[0].cabDetails.dateOfTravel;
             var dateOfTravel = date.split("\-");
             document.getElementById("date").innerHTML = dateOfTravel[2] + "-" + dateOfTravel[1] + "-" + dateOfTravel[0];
             var timeSlot = obj[0].timeSlot;
             var timeSplit = timeSlot.split(":");
             var hour = timeSplit[0];
             if(hour<12){
                    if(hour==00){
                        document.getElementById("timeslot").innerHTML = "12" + ":" + timeSplit[1] + " AM";
                    }
                    else{
                        document.getElementById("timeslot").innerHTML = hour + ":" + timeSplit[1] + " AM";
                    }
                   
                }
             else if(hour == 12) {
            	 document.getElementById("timeslot").innerHTML = hour + ":" + timeSplit[1] + " PM";
             }
               else{
                    hour = hour - 12;
                    if(hour < 10){
                        document.getElementById("timeslot").innerHTML = "0" + hour + ":" + timeSplit[1] + " PM";
                    }
                    else{
                        document.getElementById("timeslot").innerHTML = hour + ":" + timeSplit[1] +" PM";
                    }
                   
                }
            
            var tbody = document.getElementById("tablebody");
            for(var rows = 0; rows < rowLength; rows++) {
              var tr = document.createElement('tr');
              counter++;
              tr.id = "tr" + counter;
              tbody.appendChild(tr);
              tr.className = "row-bg-style";

              var td0 = document.createElement('td');
              td0.className = "number-spacing";
              td0.innerHTML = rows + 1;
              tr.appendChild(td0);
              
              var td1 = document.createElement('td');
              td1.className = "spacing";
              td1.innerHTML = obj[rows].employeeName;
              tr.appendChild(td1);

              var td2 = document.createElement('td');
              td2.className = "spacing";
              td2.innerHTML = obj[rows].employeeId;
              tr.appendChild(td2);

              var td3 = document.createElement('td');
              td3.className = "spacing";
              td3.innerHTML = obj[rows].dropPoint;
              tr.appendChild(td3);
              tbody.appendChild(tr);
                
            }
            
            document.getElementById("passengers").innerHTML = "Number of passengers : " + rowLength;
            
           }
            
           </script>
        </body>
        </html>